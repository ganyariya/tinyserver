# CLAUDE.md

このファイルは、このリポジトリでコードを扱う際のClaude Code (claude.ai/code) 向けのガイダンスを提供します。

## 重要: 必須読み込み文書

**このプロジェクトで作業する前に、必ず `Spec.md` を読み込んでください。**

`Spec.md` には以下の重要な情報が含まれています：
- プロジェクトの詳細な教育目標と学習体験設計
- 5つの実装フェーズの具体的な達成デモ
- コード品質基準とSOLID原則の適用方針
- 各フェーズで作成すべき「動くもの」の詳細仕様
- 教育用ガイド（books/）の構成方針

Spec.mdを読まずにコードを書くと、プロジェクトの教育的価値と段階的学習設計を損なう可能性があります。

## プロジェクト概要

TinyServerは、TCP/IP、HTTP、Webサーバ・クライアントの実装をGoで一から学ぶ教育的プロジェクトです。このプロジェクトは以下を重視しています：

- TCP/IPとHTTPプロトコルの教育的実装
- Go標準ライブラリのみの使用（可能な限り`net/http`パッケージを避ける）
- Goの`testing`パッケージを使用したテスト駆動開発
- SOLID原則とクリーンコード実践
- 各フェーズで動作するデモを伴った段階的学習

## 開発コマンド

プロジェクト仕様に基づき、以下のコマンドが利用可能です：

### ビルドとテスト
```bash
go build ./...          # 全パッケージをビルド
go test ./...           # 全テストを実行
go test -v ./...        # 詳細出力でテストを実行
go test ./pkg/...       # 公開APIパッケージのみテスト
go test ./internal/...  # 内部パッケージのみテスト
```

### コード品質
```bash
gofmt -w .             # コードフォーマット
go vet ./...           # 静的解析
golint ./...           # リント（golintが利用可能な場合）
```

### デモ実行（予定）
```bash
make demo-phase1       # TCP Echoサーバデモ
make demo-phase2       # HTTPパーサーデモ  
make demo-phase3       # 静的ファイルサーバデモ
make demo-phase4       # HTTPクライアントデモ
make demo-phase5       # フルスタックチャットアプリデモ
```

## アーキテクチャ

### パッケージ構造
プロジェクトは、公開APIと内部実装を明確に分離したGoのベストプラクティスに従います：

- `pkg/` - 公開APIインターフェースと型
  - `pkg/tinyserver/` - メインサーバ・クライアントインターフェース
  - `pkg/http/` - HTTPリクエスト・レスポンス型
  - `pkg/tcp/` - TCP接続インターフェース
- `internal/` - 内部実装詳細
  - `internal/tcp/` - TCP接続実装
  - `internal/http/` - HTTPパースと生成
  - `internal/server/` - ハンドラ・ミドルウェアを含むサーバ実装
  - `internal/common/` - 共通ユーティリティ（エラー、ログ）
- `cmd/` - 実行可能エントリポイント
- `demo/` - フェーズ固有の動作デモ
- `examples/` - 使用例
- `books/` - 教育用ドキュメント

### 設計原則
- **SOLID原則**: 各コンポーネントは単一責任、開放閉鎖、リスコフ置換、インターフェース分離、依存性逆転の原則に従う
- **インターフェース駆動設計**: 抽象化とテスト容易性のためのGoインターフェースの積極的活用
- **外部依存なし**: 低レベルネットワーキング理解のためGo標準ライブラリのみ使用
- **テスト駆動開発**: 全コンポーネントの包括的テストカバレッジ

### 主要インターフェース（予定）
- `pkg/tinyserver/interfaces.go`のサーバインターフェース
- `pkg/http/interfaces.go`のHTTPリクエスト・レスポンスインターフェース
- `pkg/tcp/interfaces.go`のTCP接続インターフェース

## 実装フェーズ

プロジェクトは5フェーズの学習体験として設計されています：

1. **フェーズ1**: エコーサーバ・クライアントによるTCP基礎
2. **フェーズ2**: HTTPプロトコルのパースと生成
3. **フェーズ3**: シンプルな静的ファイルWebサーバ
4. **フェーズ4**: HTTPクライアント実装
5. **フェーズ5**: フルスタックチャットアプリケーション

各フェーズは`demo/`ディレクトリに動作するデモを作成する必要があります。

## コードスタイル

- Go命名規則を厳密に従う
- 「コードは方法を、コメントは理由を」の原則でコメントを最小限に
- 自己文書化された関数名と変数名を使用
- 全ての定数は適切に命名し宣言する
- 適切な抽象化でDRY原則を適用
- 全コードが`gofmt`、`go vet`、リントツールを通すことを確認

## 📋 プロジェクト管理の必須要件

### タスク管理
**重要**: このプロジェクトはTASK.mdを使用した段階的な進捗管理が必須です。

1. **各タスク完了時の必須作業**
   - TASK.mdの該当タスクの進捗欄を更新（[ ] → [x]）
   - 実装ファイルの追加・更新情報を記録
   - 次のタスクの準備状況を確認

2. **各フェーズ完了時の必須作業**
   - 「📊 プロジェクト進捗状況」セクションの更新
   - 完了したフェーズのマーク付け（✅ COMPLETED）
   - 実装済みファイル一覧の最新化

3. **進捗管理の重要性**
   - 教育プロジェクトとして学習者の達成感を維持
   - 複数のClaude Codeセッション間での継続性確保
   - 実装の完了度と次のステップの明確化

### タスク実行の流れ
1. TASK.mdから次のタスクを確認
2. 該当タスクを"in_progress"に更新
3. 実装作業を実行
4. 完了時にタスクを"completed"に更新
5. 必要に応じて進捗状況セクションを更新